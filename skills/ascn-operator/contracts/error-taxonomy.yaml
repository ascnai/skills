version: 0.0.2

classes:
  - class: validation
    retryable: false
    severity: medium
    policy:
      action: patch_payload
      stop_after_attempts: 1
    codes:
      - E_VALIDATION_UNKNOWN_ACTIVITY_TYPE
      - E_VALIDATION_UNKNOWN_EDGE_TARGET
      - E_VALIDATION_REACHABILITY
      - E_VALIDATION_UNSUPPORTED_DIRECTIVE
      - E_VALIDATION_TOOL_RETURNS_SCHEMA_MISMATCH

  - class: context
    retryable: false
    severity: high
    policy:
      action: correct_workspace_or_workflow_binding
      stop_after_attempts: 1
    codes:
      - E_CONTEXT_WORKSPACE_MISMATCH
      - E_CONTEXT_WORKFLOW_NOT_FOUND
      - E_CONTEXT_FORBIDDEN

  - class: export_conflict
    retryable: false
    severity: medium
    policy:
      action: list_exports_then_reconcile
      stop_after_attempts: 1
    codes:
      - E_EXPORT_CANONICAL_NAME_CONFLICT
      - E_EXPORT_INVALID_OUTPUT_PATH
      - E_EXPORT_NOT_EXPOSED

  - class: transient
    retryable: true
    severity: low
    policy:
      action: retry_with_backoff
      max_attempts: 3
      initial_delay_ms: 250
    codes:
      - E_TRANSIENT_TIMEOUT
      - E_TRANSIENT_UPSTREAM_5XX
      - E_TRANSIENT_GATEWAY_UNAVAILABLE

  - class: dependency
    retryable: false
    severity: high
    policy:
      action: provide_mcp_connection_instructions
      stop_after_attempts: 1
    codes:
      - E_DEPENDENCY_MCP_NOT_CONNECTED
      - E_DEPENDENCY_REQUIRED_TOOL_MISSING

  - class: capability_gap
    retryable: false
    severity: medium
    policy:
      action: propose_reusable_integration_and_request_decision
      stop_after_attempts: 1
    codes:
      - E_CAPABILITY_MISSING_HANDLER
      - E_CAPABILITY_MISSING_TRIGGER
      - E_CAPABILITY_MISSING_AUTH
      - E_CAPABILITY_SCHEMA_GAP

mapping_hints:
  invalid_activity_type: E_VALIDATION_UNKNOWN_ACTIVITY_TYPE
  edge_points_to_unknown_node: E_VALIDATION_UNKNOWN_EDGE_TARGET
  not_reachable: E_VALIDATION_REACHABILITY
  unsupported_templating_directive: E_VALIDATION_UNSUPPORTED_DIRECTIVE
  workflow_not_found_in_workspace: E_CONTEXT_WORKFLOW_NOT_FOUND
  status_403: E_CONTEXT_FORBIDDEN
  duplicate_tool_export_name: E_EXPORT_CANONICAL_NAME_CONFLICT
  mcp_gateway_unconfigured: E_DEPENDENCY_MCP_NOT_CONNECTED
  control_tool_unavailable: E_DEPENDENCY_REQUIRED_TOOL_MISSING
  missing_handler_for_intent: E_CAPABILITY_MISSING_HANDLER
  missing_trigger_for_intent: E_CAPABILITY_MISSING_TRIGGER
  auth_capability_missing: E_CAPABILITY_MISSING_AUTH
  schema_contract_gap: E_CAPABILITY_SCHEMA_GAP
